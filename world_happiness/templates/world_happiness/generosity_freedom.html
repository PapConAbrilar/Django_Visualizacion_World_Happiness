{% extends 'world_happiness/base.html' %}

{% block container %}

<script src="https://cdn.plot.ly/plotly-3.2.0.min.js"></script>
<div id="combined-bar-chart">

    <script>

    const happyData = {{ happy_data|safe }};
    const unhappyData = {{ unhappy_data|safe }};

    const colorMap = {
        'Generosity': '#2E86AB',
        'Freedom': '#3CAEA3'
    };

    const data = [
        {
            x: happyData.Country,
            y: happyData.Generosity,
            name: 'Generosity',
            type: 'bar',
            marker: { color: colorMap.Generosity },
            xaxis: 'x1',
            yaxis: 'y1',
            legendgroup: 'group1', 
            showlegend: false, 
        },

        {
            x: happyData.Country,
            y: happyData.Freedom,
            name: 'Freedom',
            type: 'bar',
            marker: { color: colorMap.Freedom },
            xaxis: 'x1',
            yaxis: 'y1',
            legendgroup: 'group1',
            showlegend: false,
        },

        {
            x: unhappyData.Country,
            y: unhappyData.Generosity,
            name: 'Generosity',
            type: 'bar',
            marker: { color: colorMap.Generosity },
            xaxis: 'x2',
            yaxis: 'y1', 
            legendgroup: 'group2',
            showlegend: true,
        },
    
        {
            x: unhappyData.Country,
            y: unhappyData.Freedom,
            name: 'Freedom',
            type: 'bar',
            marker: { color: colorMap.Freedom },
            xaxis: 'x2',
            yaxis: 'y1',
            legendgroup: 'group2',
            showlegend: true,
        }
    ];

    const layout = {
        width: 1400,
        height: 600,
        barmode: 'stack',
        margin: { l: 20, r: 20, t: 40, b: 10 },

        grid: {
            rows: 1,
            columns: 2,
            pattern: 'independent', 
            roworder: 'bottom to top',
            subplots: [['xy', 'x2y']], 
            xaxes: ['x', 'x2'],
            yaxes: ['y', 'y'], 
            xpadding: 0,
        },
        // Titles (matching subplot_titles)
        annotations: [
            {
                text: '10 países más felices',
                x: 0.22, // Approximate center of first subplot (0 to 0.5)
                y: 1.0,
                yref: 'paper',
                xref: 'paper',
                showarrow: false,
                font: { size: 16, color:'#FFFFFF' }
            },
            {
                text: '10 países menos felices',
                x: 0.77, // Approximate center of second subplot (0.5 to 1.0)
                y: 1.0,
                yref: 'paper',
                xref: 'paper',
                showarrow: false,
                font: { size: 16, color:'#FFFFFF' }
            }
        ],
      
        xaxis: {
            domain: [0.03, 0.495], 
            tickangle: 45,
            automargin: true,
            title: {
                standoff: 0
            }
        },
        xaxis2: {
            domain: [0.505, 1],
            tickangle: 45,
            automargin: true,
            title: {
                standoff: 0
            }
        },
       
        yaxis: {
            title: 'Score', 
        },
        plot_bgcolor: 'rgba(30,30,30,0.66)',
        paper_bgcolor: 'rgba(30,30,30,0.66)',
        font: {
        color: '#FFFFFF'
        },
        showlegend: true,
        legend: {
            x: 0.91,
            y: 0.97,
        }
    };

    Plotly.newPlot('combined-bar-chart', data, layout, {responsive: true});

</script>

</div>

{% endblock %}